
		TOPPERS/HRP2カーネル
		変更履歴

		対応バージョン: Release 2.1.0
		最終更新: 2012年12月27日

このドキュメントは，TOPPERS/HRP2カーネルのRelease 2.0.0以降の変更履歴を，
新しい方から順に記述したものである．

----------------------------------------------------------------------
 TOPPERS/HRP Kernel
     Toyohashi Open Platform for Embedded Real-Time Systems/
     High Reliable system Profile Kernel

 Copyright (C) 2012 by Embedded and Real-Time Systems Laboratory
             Graduate School of Information Science, Nagoya Univ., JAPAN
 
 上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
 ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
     権表示，この利用条件および下記の無保証規定が，そのままの形でソー
     スコード中に含まれていること．
 (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
     用できる形で再配布する場合には，再配布に伴うドキュメント（利用
     者マニュアルなど）に，上記の著作権表示，この利用条件および下記
     の無保証規定を掲載すること．
 (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
     用できない形で再配布する場合には，次のいずれかの条件を満たすこ
     と．
   (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
       作権表示，この利用条件および下記の無保証規定を掲載すること．
   (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
       報告すること．
 (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
     害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
     また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
     由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
     免責すること．
 
 本ソフトウェアは，無保証で提供されているものである．上記著作権者お
 よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
 に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
 アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
 の責任を負わない．
 
 $Id: version.txt 841 2012-12-27 02:42:17Z ertl-hiro $
----------------------------------------------------------------------

		TOPPERS/HRPカーネル
		Release 2.0.0 から 2.1.0 への変更点

○変更点のリスト

・標準メモリリージョンの定義方法の変更（仕様変更）
	- 標準メモリリージョン（標準ROMリージョン，標準RAMリージョン）を，
	  ATT_REGに渡すメモリリージョン属性で指定する方法をやめ，そのための
	  静的API（DEF_SRG）で定義する方法に変更．

・prb_memをCPUロック状態からも呼べるように変更（仕様変更）

・コンフィギュレーション手順の見直し
	- 最適化を行うためのフェーズ（新パス3）を新設（target_opt.tfを追加）．
	- 最後のチェックフェーズは廃止（kernel_check.tfは削除）．チェック
	  フェーズの処理内容を，新パス4に移動．

・非タスクコンテキスト用のスタック領域のサイズチェックの追加
	- DEF_ICSのistkszがターゲット定義の最小値（TARGET_MIN_ISTKSZ）より
	  も小さい場合にE_PARエラーとする処理を追加．

・DEF_TEX，SAC_???の属する保護ドメインに関するエラーチェックを追加
	※ コンフィギュレータのRelease 1.9.0の機能に依存している．

・システムサービスのコンフィギュレーションファイルの修正
	- カーネルドメインの囲みの外側でインクルードするように修正．

・テストプログラム用ライブラリをユーザドメインからも使えるように修正
	- test_lib.hとtest_lib.cを修正．test_svc.cfgとtest_svc.cを追加．

・ログ情報出力でのエラー処理の追加
	- syslog_?マクロおよびsyslog関数内でsyslog_wri_logがエラーになった
	  場合に呼ぶためのサービスコール（syslog_fwri_log）を追加．

・使用しないサービスコールをリンクしない方法を用意
	- gensvcを修正．omit_svc.hを設ける．

・システムサービスのスタック使用量をターゲット依存で変更できるよう修正
	- システムサービスのスタック使用量を定義するためのラベル（SSZ_???）
	  を導入．

・拡張サービスコールで実現されるシステムサービスにE_MACVエラーのチェッ
　クを追加

・テストプログラムの追加

・トレースログ記録用のサンプルコードをパッケージに追加
	- ASPカーネルのパッケージに含まれているものと同じ内容．

・その他のバグフィックス
	- ミューテックスのアクセス許可ベクタの生成方法を修正．
	- メモリオブジェクト初期化ブロックのサイズの算出方法を修正．
	- TOPPERS_SUPPORT_OVRTIMをTOPPERS_SUPPORT_OVRHDRに修正．
	- システムサービスのCソースファイルを，-DTOPPERS_SVC_CALLせずにコン
	  パイルしても，関数名の衝突が起こらないように修正．

・その他の修正
	- ATT_SECのエラーコードを修正（仕様変更）．
	- 仮のメモリオブジェクト初期化ブロックの生成方法を変更．
	- ショートデータセクションを最初に配置する処理を追加．
	- コンフィギュレータのエラーメッセージにおけるAPI名の出力方法を改善．
	- オーバランハンドラをサポートしない場合に，TCBから関連フィールドを除く．
	- TOPPERS_EMPTY_LABELのデフォルトの定義をkernel_int.hに移動．
	- コンフィギュレータの最新版の機能を使って，kernel.tfをリファクタリング．
	- システムサービスの拡張サービスコールのスタックサイズを，ターゲット
	  依存部で変更できるように修正．
	- svc_table.c中のRET_TEXマクロの廃止．
	- LOG_EXTSVC_ENTERのパラメータにcdmidを追加．
	- configureに-Sオプションを追加．
	- sample/Makefileをconfigureの-kオプションに対応するよう修正．
	- gentestを拡張（CPU例外ハンドラと拡張サービスコールルーチンの生成，
	  GOTOに対応など）．
	- gensvcにHEW用のファイルを生成する機能（-Hオプション）を追加．

・ドキュメントの充実，コメントの修正

・バージョン番号の更新
	- カーネルのバージョン番号を更新．

○ターゲット依存部の要修正箇所（2.0.0 → 2.1.0）

(1) コンフィギュレーション手順の見直しに対応
	- 最適化を行う場合は，新パス3向けのファイル（target_opt.tf等）を作成．
	- チェックフェーズの処理を，新パス4に移動．
	- gcc/ldscript.tfの仕様変更（cfg2_out.ldを作る）に対応．

(2) ret_texの実装の確認
	- 設計メモの「ユーザタスクのタスク例外処理ルーチンからのリターン」
	  の節に，ret_texを実装する上での留意点を追記したため，それが満たさ
	  れているかチェック．

(3) LOG_EXTSVC_ENTERのパラメータの追加
	- LOG_EXTSVC_ENTERのパラメータにcdmidを追加したことに対応．

----------------------------------------------------------------------
